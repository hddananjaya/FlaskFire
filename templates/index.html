{% extends "header.html" %}
{% block content %}
<script>
  /*
   Create a new chat  
  */
  function create_new_note() {
    $("#btn-create-new-chat").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Creating ...');
    fetch("/new-chat/create")
      .then((data) => {
        console.log(data);
        $("#btn-create-new-chat").html("Created!");
        window.location = data['url'];
      },
        (error) => {
          console.log(error);
          $("#btn-create-new-chat").html("There is an error. Please try again.");
        });
  }
</script>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="#">
    <img src="/static/img/hexoralogo.min.png" class="hexora-logo-min" alt="hexora-logo">
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
    </ul>
    <p style="margin:5px">Hi, {{ user_name }}!</p>
    <p style="margin:5px"> <a href="/logout">Log out</a></p>
  </div>
</nav>

<div class="container" style="margin-top: 40px">
  <div class="row">
    <div class="col-lg">
    </div>
    <div class="col-lg text-center">
      {% with flash_messages = get_flashed_messages() %}
      {% if flash_messages %}
      {% for message in flash_messages %}
      <div class="alert alert-danger" role="alert">
        {{ message }}
      </div>
      {% endfor %}
      {% endif %}
      {% endwith %}
      <div class="col-lg text-center">
        <button id="btn-create-new-chat" type="button" onclick="create_new_note()" class="btn btn-success  btn-block">
          <i class="fa fa-plus" aria-hidden="true"></i> &nbsp; New Chat Room
        </button>
      </div>
    </div>
    <div class="col-lg text-center">
    </div>
  </div>

  <div class="row" style="margin-top:40px">
    <div class="col-lg-3"></div>
      <div class="col-lg-6">
      {% for chat in chats_list %}
        <div class="card" style="margin-bottom: 20px;">
          <div class="card-header text-muted chat-id">
            <div class="card-header-content">
                <div>
                  {{ chat.get("nid") }}
                </div>
                <div>
                  <a href="/chat/leave/{{ chat.get('nid') }}" class="btn btn-outline-dark btn-sm">Leave</a>
                </div>
            </div>

          </div>
          <div class="card-body">
            <h7 class="card-title">Users :</h7>
            <p class="card-text">{{ ', '.join(chat.get("users")) }}</p>
            <a href="/chat/{{ chat.get('nid') }}" class="btn btn-primary">Open</a> 
          </div>
        </div>
        {% endfor %}

    </div>

    <div class="col-lg-3"></div>

  </div>


</div>
{% endblock %}